name: Email and Commit Every 5 Minutes

on:
  schedule:
    - cron: '*/5 * * * *'  # every 5 minutes
  workflow_dispatch:

jobs:
  email-and-commit:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repo
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: pip install requests

    - name: Run email script
      env:
        TENANT_ID: ${{ secrets.TENANT_ID }}
        CLIENT_ID: ${{ secrets.CLIENT_ID }}
        CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
        EMAIL: ${{ secrets.EMAIL }}
      run: python send_email.py

    - name: Generate random commit message and commit
      run: |
        SENTENCES=(
          "Email sent successfully âœ…"
          "Automated email dispatched ðŸ“§"
          "Graph API email sent at $(date)"
          "Dev activity ongoing ðŸš€"
          "Sending emails like a pro! ðŸ“¬"
          "Keeping the inbox busy ðŸ“¨"
          "Automated email sent with love â¤ï¸"
          "Email bot in action ðŸ¤–"
          "Ping! Another email sent ðŸ“¤"
          "GitHub Actions hard at work ðŸ’»"
          "Code running smoothly âš™ï¸"
          "Another task completed âœ…"
          "Continuous integration in progress ðŸ”„"
          "Just pushing some code magic âœ¨"
          "Automating all the things ðŸ¤–"
          "Commitment to excellence ðŸ’ª"
          "Task automated and committed ðŸ“‹"
          "Logging progress step by step ðŸ“"
          "Your friendly neighborhood bot ðŸ¤"
          "Emails flying out like rockets ðŸš€"
          "Keeping the pipeline flowing ðŸŒŠ"
          "Script executed, mission accomplished ðŸŽ¯"
          "Automated updates coming through ðŸ””"
          "Pushing progress one commit at a time ðŸ› ï¸"
          "Bots do it better ðŸ¤–ðŸ”¥"
        )
        RANDOM_INDEX=$(( RANDOM % ${#SENTENCES[@]} ))
        MSG="${SENTENCES[$RANDOM_INDEX]}"
        echo "$MSG" > commit-message.txt

        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"

        # Append log with timestamp
        echo "$(date) - $MSG" >> EMAIL_LOG.md

        git add EMAIL_LOG.md commit-message.txt
        git commit -m "$MSG"
        git push origin HEAD:${{ github.ref_name }}
